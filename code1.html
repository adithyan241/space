<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lunar Calendar - Moon Phase Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --moon-glow: 0 0 30px rgba(255, 255, 255, 0.3);
            --lunar-blue: #1e40af;
            --cosmic-purple: #7c3aed;
            --star-white: #f8fafc;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0c0a1f 0%, #1e1b3a 25%, #2d1b69 50%, #1e1b3a 75%, #0c0a1f 100%);
            background-attachment: fixed;
        }
        
        .moon-title {
            font-family: 'Orbitron', monospace;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(2deg); }
        }
        
        @keyframes glow-pulse {
            0%, 100% { box-shadow: var(--moon-glow), 0 0 50px rgba(147, 197, 253, 0.3); }
            50% { box-shadow: var(--moon-glow), 0 0 80px rgba(147, 197, 253, 0.5); }
        }
        
        @keyframes slide-in {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-twinkle { animation: twinkle 2s infinite ease-in-out; }
        .animate-float { animation: float 3s infinite ease-in-out; }
        .animate-glow-pulse { animation: glow-pulse 4s infinite ease-in-out; }
        .animate-slide-in { animation: slide-in 0.6s ease-out; }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .moon-phase-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .moon-phase-card:hover {
            transform: translateY(-8px) scale(1.03);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 0 30px rgba(147, 197, 253, 0.2);
        }
        
        .stellar-bg {
            position: relative;
            overflow: hidden;
        }
        
        .stellar-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(2px 2px at 20px 30px, #fff, transparent),
                radial-gradient(2px 2px at 40px 70px, #fff, transparent),
                radial-gradient(1px 1px at 90px 40px, #fff, transparent),
                radial-gradient(1px 1px at 130px 80px, #fff, transparent),
                radial-gradient(2px 2px at 160px 30px, #fff, transparent);
            background-repeat: repeat;
            background-size: 200px 100px;
            animation: twinkle 4s infinite;
            opacity: 0.6;
        }
        
        .lunar-gradient {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6, #ec4899);
        }
        
        .phase-info-card {
            background: linear-gradient(145deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(147, 197, 253, 0.3);
        }
        
        .hidden-element { display: none; }
        .fade-in { opacity: 1; transition: opacity 0.5s ease-in-out; }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 4px;
        }
    </style>
</head>
<body class="min-h-screen stellar-bg text-white">
    
    <!-- Header -->
    <header class="relative z-10 py-8 text-center">
        <h1 class="moon-title text-4xl sm:text-6xl lg:text-7xl font-black mb-4 text-transparent bg-clip-text lunar-gradient animate-float">
            ðŸŒ™ Lunar Calendar
        </h1>
        <p class="text-lg sm:text-xl text-blue-200 font-light max-w-2xl mx-auto px-4">
            Discover the mystical phases of the moon and unlock celestial wisdom
        </p>
        <div class="flex justify-center items-center mt-6 space-x-4">
            <div class="w-2 h-2 bg-blue-400 rounded-full animate-twinkle"></div>
            <div class="w-1 h-1 bg-white rounded-full animate-twinkle" style="animation-delay: 0.5s;"></div>
            <div class="w-2 h-2 bg-purple-400 rounded-full animate-twinkle" style="animation-delay: 1s;"></div>
        </div>
    </header>

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 pb-12">
        
        <!-- Current Moon Phase Section -->
        <section class="mb-12 animate-slide-in">
            <div class="glass-card rounded-3xl p-8 sm:p-12 max-w-4xl mx-auto animate-glow-pulse">
                <div class="text-center mb-8">
                    <h2 class="text-3xl sm:text-4xl font-bold text-blue-200 mb-4">Current Lunar Phase</h2>
                    <p id="current-date" class="text-xl text-gray-300 font-medium"></p>
                </div>
                
                <div id="current-phase-content" class="flex flex-col lg:flex-row items-center justify-center gap-8">
                    <!-- Moon Visual -->
                    <div class="relative">
                        <div class="w-48 h-48 sm:w-64 sm:h-64 relative">
                            <div id="current-moon-visual" class="w-full h-full rounded-full bg-gray-200 shadow-2xl animate-float"></div>
                            <div class="absolute -top-4 -right-4 w-8 h-8 bg-yellow-400 rounded-full animate-twinkle opacity-80"></div>
                            <div class="absolute -bottom-2 -left-6 w-4 h-4 bg-blue-300 rounded-full animate-twinkle" style="animation-delay: 1s;"></div>
                        </div>
                    </div>
                    
                    <!-- Phase Information -->
                    <div class="text-center lg:text-left space-y-4">
                        <h3 id="current-phase-name" class="text-4xl sm:text-5xl font-bold text-transparent bg-clip-text lunar-gradient"></h3>
                        <div class="space-y-3">
                            <p class="text-lg text-gray-300">
                                <span class="text-blue-300 font-semibold">Illumination:</span> 
                                <span id="current-illumination" class="text-white font-bold">-</span>
                            </p>
                            <p class="text-lg text-gray-300">
                                <span class="text-purple-300 font-semibold">Age:</span> 
                                <span id="current-age" class="text-white font-bold">-</span> days
                            </p>
                            <p class="text-lg text-gray-300">
                                <span class="text-pink-300 font-semibold">Next Phase:</span> 
                                <span id="next-phase" class="text-white font-bold">-</span>
                            </p>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="flex flex-wrap gap-4 justify-center lg:justify-start mt-6">
                            <button id="insight-btn" 
                                class="px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-blue-300">
                                âœ¨ Moon Insight
                            </button>
                            <button id="story-btn"
                                class="px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white font-semibold rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-purple-300">
                                ðŸ“š Lunar Story
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Dynamic Content Area -->
                <div id="dynamic-content" class="mt-8 space-y-6">
                    <div id="insight-content" class="phase-info-card rounded-xl p-6 hidden-element">
                        <h4 class="text-xl font-bold text-blue-300 mb-3 flex items-center gap-2">
                            <span class="text-2xl">ðŸ’¡</span> Moon Phase Insight
                        </h4>
                        <p id="insight-text" class="text-gray-200 leading-relaxed"></p>
                    </div>
                    
                    <div id="story-content" class="phase-info-card rounded-xl p-6 hidden-element">
                        <h4 class="text-xl font-bold text-purple-300 mb-3 flex items-center gap-2">
                            <span class="text-2xl">âœ¨</span> Lunar Story
                        </h4>
                        <p id="story-text" class="text-gray-200 leading-relaxed italic"></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Weekly Forecast Toggle -->
        <div class="text-center mb-8">
            <button id="toggle-forecast-btn"
                class="px-8 py-4 bg-gradient-to-r from-green-500 to-teal-600 text-white font-bold text-xl rounded-full shadow-xl hover:shadow-2xl transform hover:scale-105 transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-green-300">
                ðŸ”® View 7-Day Lunar Forecast
            </button>
        </div>

        <!-- 7-Day Forecast Section -->
        <section id="forecast-section" class="hidden-element animate-slide-in">
            <div class="glass-card rounded-3xl p-8 sm:p-12 max-w-7xl mx-auto">
                <h2 class="text-3xl sm:text-4xl font-bold text-center text-green-200 mb-8">
                    7-Day Lunar Forecast
                </h2>
                
                <div id="forecast-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
                    <!-- Forecast cards will be generated here -->
                </div>
                
                <div class="text-center">
                    <button id="hide-forecast-btn"
                        class="px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-full shadow-md transform hover:scale-105 transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-gray-400">
                        Hide Forecast
                    </button>
                </div>
            </div>
        </section>

        <!-- Moon Phase Guide -->
        <section class="mt-16 animate-slide-in">
            <div class="glass-card rounded-3xl p-8 sm:p-12 max-w-6xl mx-auto">
                <h2 class="text-3xl sm:text-4xl font-bold text-center text-yellow-200 mb-8">
                    ðŸŒ• Moon Phase Guide
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="moon-phase-card rounded-xl p-6 text-center">
                        <div class="w-16 h-16 mx-auto mb-4 bg-gray-800 rounded-full"></div>
                        <h3 class="text-lg font-bold text-blue-300 mb-2">New Moon</h3>
                        <p class="text-gray-300 text-sm">New beginnings and fresh starts. Perfect for setting intentions.</p>
                    </div>
                    
                    <div class="moon-phase-card rounded-xl p-6 text-center">
                        <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-gray-800 to-gray-200 rounded-full"></div>
                        <h3 class="text-lg font-bold text-green-300 mb-2">First Quarter</h3>
                        <p class="text-gray-300 text-sm">Time for action and decision-making. Overcome challenges.</p>
                    </div>
                    
                    <div class="moon-phase-card rounded-xl p-6 text-center">
                        <div class="w-16 h-16 mx-auto mb-4 bg-gray-200 rounded-full"></div>
                        <h3 class="text-lg font-bold text-yellow-300 mb-2">Full Moon</h3>
                        <p class="text-gray-300 text-sm">Peak energy and manifestation. Celebrate achievements.</p>
                    </div>
                    
                    <div class="moon-phase-card rounded-xl p-6 text-center">
                        <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-l from-gray-800 to-gray-200 rounded-full"></div>
                        <h3 class="text-lg font-bold text-purple-300 mb-2">Last Quarter</h3>
                        <p class="text-gray-300 text-sm">Release and let go. Clear space for new opportunities.</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Enhanced Moon Phase System
        class LunarCalendar {
            constructor() {
                this.currentPhase = null;
                this.init();
            }

            init() {
                this.updateCurrentPhase();
                this.setupEventListeners();
            }

            // More accurate moon phase calculation
            getMoonPhase(date) {
                const epoch = new Date("2000-01-06T18:14:00Z");
                const synodicMonth = 29.530588853;
                const diffDays = (date.getTime() - epoch.getTime()) / (1000 * 60 * 60 * 24);
                const phaseAge = ((diffDays % synodicMonth) + synodicMonth) % synodicMonth;
                
                // Calculate illumination percentage
                const illumination = Math.round(50 * (1 - Math.cos((phaseAge / synodicMonth) * 2 * Math.PI)) * 100) / 100;
                
                // Determine phase
                let phase, nextPhase;
                if (phaseAge < 1.84566) {
                    phase = { name: "New Moon", icon: "ðŸŒ‘", class: "new-moon" };
                    nextPhase = "Waxing Crescent";
                } else if (phaseAge < 5.53699) {
                    phase = { name: "Waxing Crescent", icon: "ðŸŒ’", class: "waxing-crescent" };
                    nextPhase = "First Quarter";
                } else if (phaseAge < 9.22831) {
                    phase = { name: "First Quarter", icon: "ðŸŒ“", class: "first-quarter" };
                    nextPhase = "Waxing Gibbous";
                } else if (phaseAge < 12.91963) {
                    phase = { name: "Waxing Gibbous", icon: "ðŸŒ”", class: "waxing-gibbous" };
                    nextPhase = "Full Moon";
                } else if (phaseAge < 16.61096) {
                    phase = { name: "Full Moon", icon: "ðŸŒ•", class: "full-moon" };
                    nextPhase = "Waning Gibbous";
                } else if (phaseAge < 20.30228) {
                    phase = { name: "Waning Gibbous", icon: "ðŸŒ–", class: "waning-gibbous" };
                    nextPhase = "Last Quarter";
                } else if (phaseAge < 23.99361) {
                    phase = { name: "Last Quarter", icon: "ðŸŒ—", class: "last-quarter" };
                    nextPhase = "Waning Crescent";
                } else {
                    phase = { name: "Waning Crescent", icon: "ðŸŒ˜", class: "waning-crescent" };
                    nextPhase = "New Moon";
                }

                return { 
                    ...phase, 
                    age: Math.round(phaseAge * 10) / 10, 
                    illumination: illumination,
                    nextPhase: nextPhase
                };
            }

            createMoonVisual(phaseData) {
                const visual = document.getElementById('current-moon-visual');
                visual.innerHTML = '';
                visual.className = `w-full h-full rounded-full relative overflow-hidden ${phaseData.class}`;
                
                // Create moon base
                const moon = document.createElement('div');
                moon.className = 'w-full h-full rounded-full bg-gradient-to-br from-gray-100 to-gray-300 shadow-inner';
                
                // Create shadow for phase
                const shadow = document.createElement('div');
                shadow.className = 'absolute top-0 left-0 w-full h-full rounded-full bg-gray-900';
                
                // Apply phase-specific styling
                const illumination = phaseData.illumination;
                if (illumination === 0) {
                    shadow.style.clipPath = 'circle(50%)';
                } else if (illumination === 100) {
                    shadow.style.display = 'none';
                } else {
                    // Calculate shadow position based on phase
                    const age = phaseData.age;
                    if (age < 14.76) {
                        // Waxing phases
                        const progress = age / 14.76;
                        shadow.style.clipPath = `polygon(50% 0%, ${100 - progress * 50}% 0%, ${100 - progress * 50}% 100%, 50% 100%)`;
                    } else {
                        // Waning phases
                        const progress = (age - 14.76) / 14.76;
                        shadow.style.clipPath = `polygon(${progress * 50}% 0%, 50% 0%, 50% 100%, ${progress * 50}% 100%)`;
                    }
                }
                
                moon.appendChild(shadow);
                visual.appendChild(moon);
                
                // Add glow effect
                visual.style.boxShadow = `0 0 50px rgba(255, 255, 255, ${illumination / 200 + 0.2})`;
            }

            updateCurrentPhase() {
                const today = new Date();
                this.currentPhase = this.getMoonPhase(today);
                
                // Update UI elements
                document.getElementById('current-date').textContent = today.toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                document.getElementById('current-phase-name').textContent = this.currentPhase.name;
                document.getElementById('current-illumination').textContent = this.currentPhase.illumination + '%';
                document.getElementById('current-age').textContent = this.currentPhase.age;
                document.getElementById('next-phase').textContent = this.currentPhase.nextPhase;
                
                this.createMoonVisual(this.currentPhase);
            }

            generateForecast() {
                const grid = document.getElementById('forecast-grid');
                grid.innerHTML = '';
                
                for (let i = 1; i <= 7; i++) {
                    const date = new Date();
                    date.setDate(date.getDate() + i);
                    const phaseData = this.getMoonPhase(date);
                    
                    const card = document.createElement('div');
                    card.className = 'moon-phase-card rounded-xl p-6 text-center transform transition-all duration-300 hover:scale-105';
                    
                    card.innerHTML = `
                        <div class="text-lg font-semibold text-blue-200 mb-3">
                            ${date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}
                        </div>
                        <div class="text-4xl mb-3">${phaseData.icon}</div>
                        <h3 class="text-lg font-bold text-white mb-2">${phaseData.name}</h3>
                        <div class="text-sm text-gray-300">
                            <p>Illumination: ${phaseData.illumination}%</p>
                            <p>Age: ${phaseData.age} days</p>
                        </div>
                    `;
                    
                    grid.appendChild(card);
                    
                    // Add staggered animation
                    setTimeout(() => {
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    }, i * 100);
                }
            }

            async generateContent(type, prompt) {
                try {
                    // Simulate AI content generation (replace with actual API call)
                    const responses = {
                        insight: {
                            'New Moon': 'The New Moon represents new beginnings and fresh starts. In many cultures, it\'s considered the perfect time to set intentions and plant seeds for future growth. This phase encourages introspection and planning.',
                            'Waxing Crescent': 'The Waxing Crescent symbolizes growth and momentum. Ancient farmers would plant crops during this phase, believing the growing light would nurture their seeds. It\'s a time for taking action on your intentions.',
                            'First Quarter': 'The First Quarter moon brings challenges and decision-making opportunities. This phase tests your resolve and pushes you to overcome obstacles. Many traditions see this as a time of strength and determination.',
                            'Waxing Gibbous': 'The Waxing Gibbous phase is about refinement and adjustment. As the moon approaches fullness, it\'s time to fine-tune your efforts and prepare for manifestation. Patience and persistence are key.',
                            'Full Moon': 'The Full Moon is the peak of lunar energy, associated with completion and manifestation. Many cultures celebrate festivals during this time. It\'s when emotions run high and magic is believed to be strongest.',
                            'Waning Gibbous': 'The Waning Gibbous phase encourages gratitude and sharing. After the full moon\'s intensity, this phase brings reflection on achievements and sharing wisdom gained. It\'s a time of teaching and giving.',
                            'Last Quarter': 'The Last Quarter moon symbolizes release and letting go. This phase helps you identify what no longer serves you and provides the strength to release it. It\'s about forgiveness and clearing space.',
                            'Waning Crescent': 'The Waning Crescent is the final phase before renewal. This quiet time encourages rest, reflection, and preparation for the next cycle. Many traditions see this as a time for healing and wisdom.'
                        },
                        story: {
                            'New Moon': 'In the quiet darkness of the new moon, Luna the Moon Goddess closed her eyes and dreamed of possibilities. With each breath, she planted seeds of light in the cosmic void, knowing that in time, they would bloom into brilliant stars that would guide lost travelers home.',
                            'Waxing Crescent': 'As the first sliver of moonlight appeared, young Celeste discovered a magical silver coin in her garden. Each night, as the moon grew brighter, the coin revealed new powers, teaching her that growth comes to those who believe in their dreams.',
                            'First Quarter': 'The half-moon hung like a celestial balance scale in the sky. Below, two kingdoms stood at a crossroads, and wise Queen Artemisia knew that the moon\'s perfect symmetry held the key to bringing peace between the warring lands.',
                            'Waxing Gibbous': 'As the moon swelled with light, the enchanted lighthouse keeper polished his beacon one final time. Tomorrow, the full moon would arrive, and ships from distant lands would follow his light to discover the magical harbor hidden in the mists.',
                            'Full Moon': 'On this night of the full moon, the Silver Wolf sang her ancient song to the stars. Her melody awakened the sleeping flowers, which bloomed in silver and blue, creating a pathway of light for the Moon Dancers to celebrate until dawn.',
                            'Waning Gibbous': 'The wise old owl shared her stories with the forest creatures as the generous moon began to fade. Each tale she told glowed like moonbeams, carrying precious wisdom that would light their way through the darker nights ahead.',
                            'Last Quarter': 'Under the last quarter moon, Captain Marina released her collection of bottled tears into the ocean. As each bottle sank into the waves, her sorrows transformed into pearls of wisdom, making room in her heart for new adventures.',
                            'Waning Crescent': 'In the quiet hours before dawn, the Moon Whisperer gathered the last silver threads of moonlight. She wove them into dreams for children around the world, ensuring they would sleep peacefully until the moon returned to full brightness.'
                        }
                    };
                    
                    return responses[type][this.currentPhase.name] || 'The moon holds many mysteries waiting to be discovered.';
                } catch (error) {
                    console.error('Error generating content:', error);
                    return 'Unable to generate content at this time. Please try again later.';
                }
            }

            async handleInsight() {
                const btn = document.getElementById('insight-btn');
                const content = document.getElementById('insight-content');
                const text = document.getElementById('insight-text');
                
                btn.disabled = true;
                btn.textContent = 'Channeling lunar wisdom...';
                
                try {
                    const insight = await this.generateContent('insight');
                    text.textContent = insight;
                    content.classList.remove('hidden-element');
                    content.classList.add('animate-slide-in');
                } catch (error) {
                    text.textContent = 'The moon\'s wisdom is temporarily veiled. Please try again.';
                    content.classList.remove('hidden-element');
                } finally {
                    btn.disabled = false;
                    btn.textContent = 'âœ¨ Moon Insight';
                }
            }

            async handleStory() {
                const btn = document.getElementById('story-btn');
                const content = document.getElementById('story-content');
                const text = document.getElementById('story-text');
                
                btn.disabled = true;
                btn.textContent = 'Weaving lunar tale...';
                
                try {
                    const story = await this.generateContent('story');
                    text.textContent = story;
                    content.classList.remove('hidden-element');
                    content.classList.add('animate-slide-in');
                } catch (error) {
                    text.textContent = 'The moon\'s stories are temporarily hidden in shadow. Please try again.';
                    content.classList.remove('hidden-element');
                } finally {
                    btn.disabled = false;
                    btn.textContent = 'ðŸ“š Lunar Story';
                }
            }

            setupEventListeners() {
                document.getElementById('insight-btn').addEventListener('click', () => this.handleInsight());
                document.getElementById('story-btn').addEventListener('click', () => this.handleStory());
                
                document.getElementById('toggle-forecast-btn').addEventListener('click', () => {
                    const section = document.getElementById('forecast-section');
                    const btn = document.getElementById('toggle-forecast-btn');
                    
                    if (section.classList.contains('hidden-element')) {
                        this.generateForecast();
                        section.classList.remove('hidden-element');
                        btn.textContent = 'ðŸ”® Hide Lunar Forecast';
                    } else {
                        section.classList.add('hidden-element');
                        btn.textContent = 'ðŸ”® View 7-Day Lunar Forecast';
                    }
                });
                
                document.getElementById('hide-forecast-btn').addEventListener('click', () => {
                    document.getElementById('forecast-section').classList.add('hidden-element');
                    document.getElementById('toggle-forecast-btn').textContent = 'ðŸ”® View 7-Day Lunar Forecast';
                });
            }
        }

        // Initialize the Lunar Calendar
        document.addEventListener('DOMContentLoaded', () => {
            const calendar = new LunarCalendar();
            
            // Add periodic updates every hour
            setInterval(() => {
                calendar.updateCurrentPhase();
            }, 3600000);
        });

        // Additional interactive features
        class LunarEffects {
            constructor() {
                this.setupParticles();
                this.setupHoverEffects();
            }

            setupParticles() {
                // Create floating particles
                const particleContainer = document.createElement('div');
                particleContainer.className = 'fixed inset-0 pointer-events-none z-0';
                document.body.appendChild(particleContainer);

                for (let i = 0; i < 20; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'absolute w-1 h-1 bg-white rounded-full opacity-30';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.top = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 4 + 's';
                    particle.style.animationDuration = (Math.random() * 3 + 2) + 's';
                    particle.classList.add('animate-twinkle');
                    particleContainer.appendChild(particle);
                }
            }

            setupHoverEffects() {
                // Add interactive hover effects to cards
                const cards = document.querySelectorAll('.moon-phase-card, .glass-card');
                cards.forEach(card => {
                    card.addEventListener('mouseenter', function() {
                        this.style.transform = this.style.transform + ' scale(1.02)';
                    });
                    
                    card.addEventListener('mouseleave', function() {
                        this.style.transform = this.style.transform.replace(' scale(1.02)', '');
                    });
                });
            }
        }

        // Weather and location integration
        class LunarLocation {
            constructor() {
                this.setupLocationFeatures();
            }

            async setupLocationFeatures() {
                try {
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(
                            (position) => this.handleLocationSuccess(position),
                            (error) => this.handleLocationError(error)
                        );
                    }
                } catch (error) {
                    console.log('Geolocation not supported');
                }
            }

            handleLocationSuccess(position) {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;
                
                // Add moonrise/moonset calculation
                this.calculateMoonTimes(lat, lon);
            }

            handleLocationError(error) {
                console.log('Location access denied');
                // Use default times or general location
            }

            calculateMoonTimes(lat, lon) {
                // Simplified moonrise/moonset calculation
                const today = new Date();
                const moonrise = new Date(today);
                const moonset = new Date(today);
                
                // Approximate times (would use actual astronomical library in production)
                moonrise.setHours(18, 30, 0, 0);
                moonset.setHours(6, 30, 0, 0);
                
                this.displayMoonTimes(moonrise, moonset);
            }

            displayMoonTimes(moonrise, moonset) {
                const timeInfo = document.createElement('div');
                timeInfo.className = 'phase-info-card rounded-xl p-6 mt-6';
                timeInfo.innerHTML = `
                    <h4 class="text-xl font-bold text-cyan-300 mb-3 flex items-center gap-2">
                        <span class="text-2xl">ðŸŒ…</span> Moon Times (Local)
                    </h4>
                    <div class="flex justify-between text-gray-200">
                        <div>
                            <p class="font-semibold">Moonrise</p>
                            <p class="text-cyan-300">${moonrise.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</p>
                        </div>
                        <div>
                            <p class="font-semibold">Moonset</p>
                            <p class="text-orange-300">${moonset.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</p>
                        </div>
                    </div>
                `;
                
                document.getElementById('dynamic-content').appendChild(timeInfo);
            }
        }

        // Lunar calendar features
        class LunarCalendarFeatures {
            constructor() {
                this.addMonthlyView();
                this.addExportFeature();
            }

            addMonthlyView() {
                // Add monthly calendar view button
                const monthlyBtn = document.createElement('button');
                monthlyBtn.id = 'monthly-view-btn';
                monthlyBtn.className = 'px-6 py-3 bg-gradient-to-r from-indigo-500 to-blue-600 text-white font-semibold rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-indigo-300 ml-4';
                monthlyBtn.textContent = 'ðŸ“… Monthly View';
                
                document.getElementById('toggle-forecast-btn').parentNode.appendChild(monthlyBtn);
                
                monthlyBtn.addEventListener('click', () => this.showMonthlyView());
            }

            showMonthlyView() {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
                modal.innerHTML = `
                    <div class="glass-card rounded-3xl p-8 max-w-4xl w-full max-h-screen overflow-auto">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl font-bold text-blue-200">Monthly Lunar Calendar</h3>
                            <button id="close-monthly" class="text-gray-400 hover:text-white text-2xl">&times;</button>
                        </div>
                        <div id="monthly-calendar" class="grid grid-cols-7 gap-2 text-center">
                            <!-- Calendar will be generated here -->
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                this.generateMonthlyCalendar();
                
                document.getElementById('close-monthly').addEventListener('click', () => {
                    document.body.removeChild(modal);
                });
                
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                    }
                });
            }

            generateMonthlyCalendar() {
                const calendar = document.getElementById('monthly-calendar');
                const today = new Date();
                const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
                const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                
                // Days of week header
                const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                days.forEach(day => {
                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'font-bold text-gray-300 p-2';
                    dayHeader.textContent = day;
                    calendar.appendChild(dayHeader);
                });
                
                // Empty cells for days before month start
                for (let i = 0; i < firstDay.getDay(); i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = 'p-2';
                    calendar.appendChild(emptyCell);
                }
                
                // Calendar days with moon phases
                const lunarCalendar = new LunarCalendar();
                for (let day = 1; day <= lastDay.getDate(); day++) {
                    const cellDate = new Date(today.getFullYear(), today.getMonth(), day);
                    const phase = lunarCalendar.getMoonPhase(cellDate);
                    
                    const dayCell = document.createElement('div');
                    dayCell.className = 'moon-phase-card rounded-lg p-3 text-center hover:scale-105 transition-all duration-200';
                    if (cellDate.toDateString() === today.toDateString()) {
                        dayCell.classList.add('ring-2', 'ring-blue-400');
                    }
                    
                    dayCell.innerHTML = `
                        <div class="font-semibold text-white mb-1">${day}</div>
                        <div class="text-lg">${phase.icon}</div>
                        <div class="text-xs text-gray-300 mt-1">${phase.illumination}%</div>
                    `;
                    
                    calendar.appendChild(dayCell);
                }
            }

            addExportFeature() {
                const exportBtn = document.createElement('button');
                exportBtn.className = 'px-4 py-2 bg-gradient-to-r from-pink-500 to-red-600 text-white font-semibold rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-pink-300 ml-4';
                exportBtn.textContent = 'ðŸ“¥ Export Data';
                
                document.getElementById('monthly-view-btn').parentNode.appendChild(exportBtn);
                
                exportBtn.addEventListener('click', () => this.exportLunarData());
            }

            exportLunarData() {
                const lunarCalendar = new LunarCalendar();
                const today = new Date();
                const data = [];
                
                // Generate data for next 30 days
                for (let i = 0; i < 30; i++) {
                    const date = new Date(today);
                    date.setDate(today.getDate() + i);
                    const phase = lunarCalendar.getMoonPhase(date);
                    
                    data.push({
                        date: date.toISOString().split('T')[0],
                        phase: phase.name,
                        illumination: phase.illumination,
                        age: phase.age
                    });
                }
                
                // Create and download CSV
                const csv = this.convertToCSV(data);
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.setAttribute('hidden', '');
                a.setAttribute('href', url);
                a.setAttribute('download', 'lunar_calendar_data.csv');
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }

            convertToCSV(data) {
                const headers = Object.keys(data[0]);
                const csvContent = [
                    headers.join(','),
                    ...data.map(row => headers.map(header => row[header]).join(','))
                ].join('\n');
                
                return csvContent;
            }
        }

        // Initialize all features
        document.addEventListener('DOMContentLoaded', () => {
            new LunarEffects();
            new LunarLocation();
            new LunarCalendarFeatures();
        });
    </script>
</body>
</html>